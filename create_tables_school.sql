/*
CREATE TABLE X (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	
	PRIMARY KEY (ID)
);
*/

CREATE TABLE PERSON (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	NAME_FIRST VARCHAR(32) NOT NULL,
	NAME_LAST VARCHAR(32) NOT NULL,
	PHONE_NUM VARCHAR(10) NOT NULL, /* https://stackoverflow.com/a/75136/12940139 */
	EMAIL VARCHAR(319) NOT NULL, /* https://dba.stackexchange.com/a/37021 */
	PRIMARY KEY(ID)
);

CREATE TABLE SEMESTER (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	SEASON VARCHAR(6),
	YEAR SMALLINT, /* https://stackoverflow.com/a/697893/12940139 */
	PRIMARY KEY(ID)
);

CREATE TABLE GRADE_LEVEL (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	NAME VARCHAR(32),
	PRIMARY KEY(ID)
);

CREATE TABLE DEPARTMENT (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	NAME VARCHAR(32),
	PRIMARY KEY(ID)
);

CREATE TABLE STUDENT (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	PERSON_ID INT NOT NULL,
	GRADE_LEVEL_ID INT NOT NULL,
	SEMESTER_ID_GRADUATION INT NOT NULL,
	GPA DECIMAL(4, 3),
	FOREIGN KEY(PERSON_ID) REFERENCES PERSON(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(SEMESTER_ID_GRADUATION) REFERENCES SEMESTER(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(GRADE_LEVEL_ID) REFERENCES GRADE_LEVEL(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	PRIMARY KEY(ID)
);

CREATE TABLE CLASS (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	DEPARTMENT_ID INT NOT NULL,
	GRADE_LEVEL_ID INT NOT NULL,
	FOREIGN KEY(DEPARTMENT_ID) REFERENCES DEPARTMENT(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(GRADE_LEVEL_ID) REFERENCES GRADE_LEVEL(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	PRIMARY KEY(ID)
);

CREATE TABLE STUDENT_CLASS (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	STUDENT_ID INT NOT NULL,
	CLASS_ID INT NOT NULL,
	SEMESTER_ID INT NOT NULL,
	GRADE DECIMAL(4, 3),
	GRADE_LETTER VARCHAR(2),
	FOREIGN KEY(STUDENT_ID) REFERENCES STUDENT(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(CLASS_ID) REFERENCES CLASS(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(SEMESTER_ID) REFERENCES SEMESTER(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	PRIMARY KEY(ID)
);

CREATE TABLE ROOM (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	ROOM_NUMBER SMALLINT,
	BUILDING VARCHAR(32),
	BUILDING_FLOOR SMALLINT,
	BUILDING_WING VARCHAR(32),
	PRIMARY KEY (ID)
);

CREATE TABLE INSTRUCTOR (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	PERSON_ID INT NOT NULL,
	DEPARTMENT_ID INT NOT NULL,
	GRADE_LEVEL_ID INT NOT NULL,
	ROOM_ID_HOME INT NOT NULL,
	FOREIGN KEY(PERSON_ID) REFERENCES PERSON(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(DEPARTMENT_ID) REFERENCES DEPARTMENT(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(GRADE_LEVEL_ID) REFERENCES GRADE_LEVEL(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(ROOM_ID_HOME) REFERENCES ROOM(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	PRIMARY KEY (ID)
);

CREATE TABLE CLASS_ROOM (
	ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	CLASS_ID INT NOT NULL,
	ROOM_ID INT NOT NULL,
	SEMESTER_ID INT NOT NULL,
	INSTRUCTOR_ID INT NOT NULL,
	TIME_START TIME NOT NULL,
	TIME_END TIME NOT NULL,
	FOREIGN KEY(CLASS_ID) REFERENCES CLASS(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(ROOM_ID) REFERENCES ROOM(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(SEMESTER_ID) REFERENCES SEMESTER(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY(INSTRUCTOR_ID) REFERENCES INSTRUCTOR(ID) ON UPDATE RESTRICT ON DELETE CASCADE,
	PRIMARY KEY(ID)
);
